import org.joda.time.*
import org.openhab.model.script.actions.Timer

var Timer lightOn
val int lightColorIndex = 0

rule "Hue Color Cycle"
when
    Item EnOcean_sensor_00298B1A_A received update 
then
    lightColorIndex += 1
    var DecimalType hue = new DecimalType(lightColorIndex * 15)

    if(hue >= 360) {
        lightColorIndex = 0
    }

    var PercentType sat = new PercentType(100)
    var PercentType bright = new PercentType(100)
    var HSBType light = new HSBType(hue,sat,bright)

    sendCommand(Hue_Bulb_1_Color, light)
    
    if(lightOn!=null) {
       lightOn.cancel()
    }
    lightOn = createTimer(now.plusMinutes(60)) [|
        sendCommand(Hue_Bulb_1_Dimmer, 0)
    ]

end

